import requests
import json
import os
import time
from gtts import gTTS

# 1. Settings (Aapki API Key aur URL)
API_KEY = "AIzaSyBpXf5sfUvA0xsKmYA2eajvw-8spYN7tm0"
MODEL_NAME = "gemini-3-flash-preview"
URL = f"https://generativelanguage.googleapis.com/v1beta/models/{MODEL_NAME}:generateContent?key={API_KEY}"

def speak(text):
    """AI ke jawab ko bolkar sunane ke liye function"""
    try:
        # Purani file saaf karna
        filename = "radhe_reply.mp3"
        if os.path.exists(filename):
            os.remove(filename)
            
        # Voice file banana
        tts = gTTS(text=text, lang='hi')
        tts.save(filename)
        
        # Pydroid/Android par file play karne ka sabse asaan tarika
        # Ye command direct mobile player ko signal bhejti hai
        os.system(f"am start --user 0 -a android.intent.action.VIEW -d file://{os.getcwd()}/{filename} -t audio/mp3")
        
    except Exception as e:
        print(f"\n[Voice Error]: {e}")

def radhe_ai():
    print("--- ✨ Radhe AI (Voice Mode) Active Hai! ✨ ---")
    print("Dilip ji, aap mujhse kuch bhi pooch sakte hain.\n")
    
    while True:
        # Input lena
        user_input = input("Aap: ")
        
        if user_input.lower() in ['exit', 'quit', 'bye', 'band karo']:
            speak("Radhe Radhe Dilip ji! Phir milenge.")
            print("Radhe AI: Radhe Radhe!")
            break

        # AI ko bhejne wala data
        payload = {
            "contents": [{
                "parts": [{
                    "text": f"Your name is Radhe AI. You are talking to Dilip. Always start with 'Radhe Radhe'. Keep answers short, friendly and in Hindi. Question: {user_input}"
                }]
            }]
        }

        headers = {'Content-Type': 'application/json'}

        try:
            # Google AI se jawab maangna
            response = requests.post(URL, headers=headers, json=payload)
            result = response.json()
            
            if 'candidates' in result:
                ai_text = result['candidates'][0]['content']['parts'][0]['text']
                print(f"\nRadhe AI: {ai_text}\n")
                
                # AI ko bolne ke liye kehna
                speak(ai_text)
            else:
                error_msg = result.get('error', {}).get('message', 'API connection issues')
                print(f"Radhe AI: Maaf kijiye, kuch dikkat aa rahi hai. {error_msg}")
                
        except Exception as e:
            print(f"\n[System Error]: {e}")

if __name__ == "__main__":
    radhe_ai()
